CVE-2022-29800은 TOCTOU(time-of-check-time-of-use) 경쟁 조건으로, 공격자가 networkd-dispatcher(취약한 시스템 단위)가 루트가 소유하고 있다고 믿는 스크립트를 다음과 같은 스크립트로 교체할 수 있습니다. 아니다. 여기에 연구원들이 동시에 발견한 symlink 경쟁 조건을 추가하면 권한 상승을 달성할 수 있는 열린 경로가 있습니다.

취약점 CVE-2022-29799 및 CVE-2022-29800
Microsoft 연구원 Jonathan Bar Or는
 Networkd-Dispatcher의 소스 코드를 보고 "_run_hooks_for_state"로 알려진 구성 요소가 Linux 시스템을 디렉터리 탐색 
취약성(CVE-2022-29799)에 노출되도록 하는 특정 논리를 구현하는 구성 요소라고 언급했습니다. "_run_hooks_for_state" 구성 요소가 올바른 스크립트 경로를 생성하는 데 사용되는 상태를 적절하게 삭제하는 기능을 사용하지 않는 것으로 나타났습니다. 그 결과, 위협 행위자는 취약점을 악용하여 기본 디렉토리 "/ etc / networkd-dispatcher"를 종료할 수 있습니다.

그러나 run-hooks_for_state에는 CVE-2022-29800으로 알려진 두 번째 취약점이 포함되어 있어 Linux 시스템을 TOCTOU 경쟁 조건에 취약하게 만듭니다. 이것은 스크립트 감지와 스크립트 실행 사이에 약간의 시간이 있기 때문에 가능합니다. 해커는 CVE-2022-29800을 이용하여 Networkd-Dispatcher가 루트가 소유한 것으로 생각하는 스크립트를 악성 스크립트로 교체할 수 있습니다.
—Description—
공격자는 특정 이벤트를 기반으로 실행을 트리거하는 시스템 메커니즘을 사용하여 지속성을 설정하거나 권한을 높일 수 있습니다. 다양한 운영 체제에는 로그온과 같은 이벤트 또는 특정 응용 프로그램/바이너리 실행과 같은 기타 사용자 활동을 모니터링하고 구독하는 수단이 있습니다.

공격자는 PowerShell 프로필에 의해 트리거된 악성 콘텐츠를 실행하여 지속성을 획득하고 권한을 높일 수 있습니다. PowerShell 프로필(profile.ps1)은 PowerShell이 ​​시작될 때 실행되는 스크립트이며 사용자 환경을 사용자 지정하기 위한 로그온 스크립트로 사용할 수 있습니다.
—Attack Payload—
-Use PowerShell
 
 
—Detection—


CVE-2022-29799 및 CVE-2022-29800, 공격자는 두 가지의 Nimbuspwn 취약점을 악용하면 Linux 시스템에서 루트 권한을 얻기 위해 연결되어 공격자가 루트 백도어와 같은 페이로드를 배포하고 임의의 루트 코드 실행을 통해 기타 악의적인 작업을 수행할 수 있습니다. 
CVE-2022-29799는 'networkd-dispatcher' 구성 요소 구현 에서 누락된 검사의 결과로 발생하는 경로 탐색 취약점 입니다. Path Traversal 공격은 웹 루트 폴더 외부에 저장된 파일 및 디렉토리에 액세스하는 것을 목표로 합니다. ‘../’ 시퀀스 및 그 변형이 있는 파일을 참조하는 변수를 조작하거나 절대 파일 경로를 사용하여 애플리케이션 소스 코드 또는 구성을 포함하여 파일 시스템에 저장된 임의의 파일 및 디렉토리에 액세스할 수 있습니다. 중요한 시스템 파일. Path Traversal 공격을 사용하여 공격자는 자신이 만든 악성 디렉터리에 액세스할 수 있습니다.
CVE-2022-29800는 확인된 디렉터리에서 루트 권한이 있는 스크립트를 확인하기 위해 `networkd-dispatcher'가 수행 하는 확인 확인으로 인해 발생하는 TOCTOU(Time of Check – Time of Use) 경쟁 조건 취약점 입니다. 많은 양의 스크립트를 검증해야 하는 경우 검사에 시간이 걸리며, 한편 공격자는 하위 디렉토리를 교체하고 대신 동일한 이름의 악성 스크립트가 실행되도록 할 수 있습니다.

